To better understand the effects of interference and multipath (due to re?ected signals) on distance estimation, we characterize the different RF and ultrasonic signals that a listener can hear. Consider the RF and ultrasonic signals sent by a beacon A and an interfering beaconI. The listener potentially hears the following signals:
We only need to consider the cases when a US pulse arrives while some RF signal is being received. The reception of the ?rst ultrasonic signal US-A, US-RA, US-I, or US-RI while RF-A is being received will cause the listener to calculate the distance to A using the time interval between the detection of RF-A and the particular ultrasonic signal. This is because the listener, after receiving the RF signal from a beacon, waits for the ?rst occurrence of an ultrasonic pulse to determine the distance. All subsequent ultrasonic receptions that arrive during this RF message are ignored. Of course, if the direct signal US-A is the ?rst one to be received, the listener correctly estimates the distance to A . However, the wrong correlation of any other ultrasonic signal with RF-A could be problematic.
Case 1: RF-A:US-RA. This combination with the re?ected ultrasonic signal from
 Acauses the estimated distance to be larger than the actual distance to A. This situation can occur only if the direct signal US-A was never received by the listener. However, the problems caused by this to the system can be reduced by properly aligned beacons (Section 3.3), as well as using multiple independent beacons per geographic space. In addition, in our experience, we have found that the ability of the ultrasonic waves to bend around obstacle edges (diffraction) makes this a relatively infrequent occurrence since the direct signal is usually detected before the re?ected one.
Case 2: RF-A:US-I. This is the combination of RF-A with the direct ultrasonic signal from an interfering beacon I , which arrives before the ultrasonic signal US-A. Since an ultrasonic pulse can only be received by a listener while the corresponding RF datapacket is being received, RF-I should also be in transit to the listener. Hence RF-A and RF-I should overlap at the listener as shown in Figure 1.
If RF-A and RF-I are comparable in signal strength, they will collide, causing the listener to ignore this event because both RF messages will be corrupted. On the other hand, if the signal strength of RF-I is substantially larger than RF-A, the two may not collide and the listener will end up calculating the correct distance to beacon I .
The only situation that leads to a wrong distance estimate is when the signal strength of RF-I is much smaller than RF-A, causing the listener to use the RF-A:US-I combination to determine the distance to A. We reduce the chances of this event by using RF signals with longer range than US signals. This generally ensures a strong RF reception whenever the corresponding ultrasonic signal is received (hence the receipt of US-I, in general ensures a strong RF-I).
Case 3. RF-A:US-RI. This occurs when a stray re?ected signal from an interfering beacon I appears before US-A. As before, this can lead to wrong distance estimates as well.
Although cases 2 and 3 may lead to incorrect distance estimates, our use of randomization reduces the repeated calculation of wrong estimates. If there are a large number of beacons in close proximity to each other, there can be a non-negligible number of wrong distance estimates at the receivers. At this point, we have engineered our system to ensure that there are not more than ?ve or six beacons that are within range of each other at any location.
In addition, listeners do not simply use the ?rst sample pair they get to infer their best location. Rather, they collect multiple samples and use an inference algorithm for this.
